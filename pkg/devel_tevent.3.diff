--- ../tevent.orig/files/patch-buildtools_wafsamba_samba__autoconf.py	2019-11-19 16:52:58.654621000 +0000
+++ ./files/patch-buildtools_wafsamba_samba__autoconf.py	2019-11-17 06:51:28.895171000 +0000
@@ -1,6 +1,6 @@
---- buildtools/wafsamba/samba_autoconf.py.orig	2019-03-21 10:12:32 UTC
-+++ buildtools/wafsamba/samba_autoconf.py
-@@ -573,7 +573,7 @@ def library_flags(self, libs):
+--- buildtools/wafsamba/samba_autoconf.py.orig	2019-09-03 16:59:55.000000000 +0300
++++ buildtools/wafsamba/samba_autoconf.py	2019-11-07 22:09:56.352988000 +0300
+@@ -573,7 +573,7 @@
  
  
  @conf
@@ -9,7 +9,7 @@
      '''check if a set of libraries exist as system libraries
  
      returns the sublist of libs that do exist as a syslib or []
-@@ -593,11 +593,14 @@ int foo()
+@@ -593,11 +593,14 @@
              ret.append(lib)
              continue
  
@@ -26,11 +26,10 @@
  
          if not res:
              if mandatory:
-@@ -925,6 +928,5 @@ def SAMBA_CHECK_UNDEFINED_SYMBOL_FLAGS(c
+@@ -944,5 +947,5 @@
          conf.env.undefined_ldflags = conf.ADD_LDFLAGS('-Wl,-no-undefined', testflags=True)
  
-     if not sys.platform.startswith("openbsd") and conf.env.undefined_ignore_ldflags == []:
--        if conf.CHECK_LDFLAGS(['-undefined', 'dynamic_lookup']):
-+        if conf.CHECK_LDFLAGS(['-undefined', 'dynamic_lookup'] + conf.env.WERROR_CFLAGS):
+         if (conf.env.undefined_ignore_ldflags == [] and
+-            conf.CHECK_LDFLAGS(['-undefined', 'dynamic_lookup'])):
++            conf.CHECK_LDFLAGS(['-undefined', 'dynamic_lookup'] + conf.env.WERROR_CFLAGS)):
              conf.env.undefined_ignore_ldflags = ['-undefined', 'dynamic_lookup']
--
